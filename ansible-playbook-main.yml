---

- hosts: localhost

  tasks:
    - local_action:
        command ansible-galaxy install atosatto.minio

- hosts: all
  gather_facts: true
  remote_user: root
  tasks:

    - name: Update
      raw: apt-get -y --allow-unauthenticated update || true

    - name: Upgrade
      raw: apt-get -y --allow-unauthenticated upgrade

    - name: Ensure python is available
      raw: test -e /usr/bin/python || apt install -y --allow-unauthenticated python-minimal

    - name: Ensure python-apt is available
      raw: test -d /usr/share/python-apt || apt install -y --allow-unauthenticated python-apt

    - name: Ensure python-pip is available
      raw: test -d /usr/share/python-pip || apt install -y --allow-unauthenticated python-pip

    - name: Ensure python-pip is available
      raw: pip install urllib3[secure]

- hosts: minio
  remote_user: root
  roles:
    - atosatto.minio
  vars:
    minio_server_datadirs: [ "/minio-data" ]
    minio_server_make_datadirs: true
    minio_access_key: "{{ accessKey }}"
    minio_secret_key: "{{ secretKey }}"
    minio_server_cluster_nodes:
      - 'http://172.28.4.3:9000'
      - 'http://172.28.4.5:9000'
